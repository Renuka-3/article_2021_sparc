theme_set(theme_bw(base_size = 25))
ggplot(h, aes(x = value, y = prevalence, color= Genus )) + geom_point()
theme_set(theme_bw(base_size = 25))
ggplot(h, aes(x = value, y = prevalence, color= Genus )) + geom_point()
theme_set(theme_bw(base_size = 20))
ggplot(h, aes(x = value, y = prevalence, color= Genus )) + geom_point()
#b <- aggregate_taxa(phy20.1, level = "genus")
#cd <- abundances(transform(b, "compositional"))
#xd <- reshape2::melt(cd)
#df$phylum <- map_levels(taxa = df$genus, from = "genus", to = "phylum", data = phy20.1)
#ggplot(df, aes(x = Genus, y = value, fill = phylum)) + geom_boxplot()
#b <- aggregate_taxa(ps.core, level = "genus")
#b <- aggregate_taxa(ps.core, level = "unique")
#cd <- abundances(transform(b, "compositional"))
#xd <- reshape2::melt(cd)
#df$phylum <- map_levels(taxa = df$unique, from = "unique", to = "phylum", data = b)
#ggplot(df, aes(x = Genus, y = value, fill = phylum)) + geom_boxplot()
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
bs$Var3 = str_wrap(bs$Var2, width =30)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
#df$phylum <- map_levels(taxa = df$genus, from = "genus", to = "phylum", data = b.core)
#x <- abundances(phy20.1, level = "genus") #["genus", ]
#xd <- reshape2::melt(x)
#df$Phylum <- map_levels(taxa = df$Genus, from = "Genus", to = "Phylum", data = pseq)
#ggplot(df, aes(x = Genus, y = abundance, fill = Phylum)) + geom_boxplot()
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
df$Genus <- factor(df$Genus, levels=unique(df$Genus))
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
df$Genus <- factor(df$Genus, levels= from "A" to "B")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
df$Genus <- factor(df$Genus, levels= "A", "B")
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
#df$Genus <- factor(df$Genus, levels= "A", "B")
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
df %>% mutate(name = fct_reorder(name, val))
df %>% mutate(name = fct_reorder(Genus, Prvalance(%))))
df %>% mutate(name = fct_reorder(Genus, Prvalance(%)))
df %>% mutate(name = fct_reorder(Genus, Prvalance(%))
df %>% mutate(name = fct_reorder(Genus, Prvalance(%))) %>%
df %>% mutate(name = fct_reorder(Genus, Prvalance(%))) % > % + ggplot()
df%>% mutate(name = fct_reorder(Genus, Prvalance(%))) %>% + ggplot()
df%>% mutate(name = fct_reorder(Genus, Prvalance)) %>% + ggplot()
df%>% mutate(name = fct_reorder(Prvalance,Genus )) %>% + ggplot()
df %>% mutate(name = fct_reorder(Genus, Prevalance(%))) %>% + ggplot()
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
library(forcats)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
#df$Genus <- factor(df$Genus, levels= "A", "B")
df %>% mutate(name = fct_reorder(name, val)) %>% + ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
df %>% mutate(name = fct_reorder(Genus, Prevalance(%))) %>% + ggplot()
df %>% mutate(name = fct_reorder(Genus, Prevalance(%))) %>%  ggplot()
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
library(forcats)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
#df$Genus <- factor(df$Genus, levels= "A", "B")
df %>% mutate(name = fct_reorder(name, val)) %>% + ggplot(df, aes(x = Genus , y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
#df$Genus <- factor(df$Genus, levels= "A", "B")
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
#df$Genus <- factor(df$Genus, levels= "A", "B")
ggplot(df, aes(x = reorder(Genus, -prevalence), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
#df$Genus <- factor(df$Genus, levels= "A", "B")
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#b <- aggregate_taxa(phy20.1, level = "genus")
#cd <- abundances(transform(b, "compositional"))
#xd <- reshape2::melt(cd)
#df$phylum <- map_levels(taxa = df$genus, from = "genus", to = "phylum", data = phy20.1)
#ggplot(df, aes(x = Genus, y = value, fill = phylum)) + geom_boxplot()
#b <- aggregate_taxa(ps.core, level = "genus")
#b <- aggregate_taxa(ps.core, level = "unique")
#cd <- abundances(transform(b, "compositional"))
#xd <- reshape2::melt(cd)
#df$phylum <- map_levels(taxa = df$unique, from = "unique", to = "phylum", data = b)
#ggplot(df, aes(x = Genus, y = value, fill = phylum)) + geom_boxplot()
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
bs$Var3 = str_wrap(bs$Var2, width =30)
p4 <- ggplot(bs, aes(x = reorder(Var1, -value), y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
#df$phylum <- map_levels(taxa = df$genus, from = "genus", to = "phylum", data = b.core)
#x <- abundances(phy20.1, level = "genus") #["genus", ]
#xd <- reshape2::melt(x)
#df$Phylum <- map_levels(taxa = df$Genus, from = "Genus", to = "Phylum", data = pseq)
#ggplot(df, aes(x = Genus, y = abundance, fill = Phylum)) + geom_boxplot()
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
#df$Genus <- factor(df$Genus, levels= "A", "B")
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
ggplot(df, aes(x = reorder(Genus, -prevalence), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
df$Genus <- factor(df$Genus, levels= c("A": "z"))
df
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
#df$Genus <- factor(df$Genus, levels= c("Acinetobacter", ""))
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#ggplot(df, aes(x = reorder(Genus, -prevalence), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
df$Genus <- factor(df$Genus, levels= c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium",
"Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus"))
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation", xlab="names in desired order")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
df$Genus <- factor(df$Genus, levels= c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium",
"Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus"))
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation", xlab="names in desired order")
#ggplot(df, aes(x = reorder(Genus, -prevalence), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
df$Genus <- factor(df$Genus, levels= c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium",
"Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus"))
ggplot(df, aes(x = df$Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#ggplot(df, aes(x = reorder(Genus, -prevalence), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
ggplot(df, aes(x = reorder(-Genus), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
df$Genus <- factor(df$Genus, levels= c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium",
"Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus"))
ggplot(df, aes(x = reorder(Genus, desc), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
df$Genus <- factor(df$Genus, levels= c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium",
"Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus"))
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#ggplot(df, aes(x = reorder(Genus, -prevalence), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
df$Genus <- factor(df$Genus, levels= c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium",
"Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus"))
ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#ggplot(df, aes(x = reorder(Genus, -prevalence), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
library(knitr)
require(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
core_detection <- .1/100
core_prevalence <- 50/100
# Was created with: source("create_phyloseq.R")
phy20.1 <- readRDS("data/processed/phyloseq/phy20.1.RDS")
ps <- aggregate_taxa(phy20.1, "genus")
ps <- microbiome::transform(ps, "compositional")
ps.core <- core(ps, detection = core_detection, prevalence = core_prevalence)
m <- round(100 * rowMeans(abundances(ps.core)), 1)
median <- round(100 * apply(abundances(ps.core), 1, median), 1)
prev <- round(100 * prevalence(ps.core, detection = core_detection), 1)
d <- as.data.frame(list(Taxon = names(m), Abundance_mean = m, Abundance_median = median, Prevalence = prev))
rownames(d) <- NULL
d <- d %>% arrange(desc(Abundance_mean), desc(Prevalence))
colnames(d) <- c("Taxon", "Mean Relative abundance (%)", "Median Relative abundance (%)", "Prevalence (%)")
kable(d)
theme_set(theme_bw(base_size = 13))
dfm <- melt(abundances(ps.core))
dfm$Var1 <- factor(dfm$Var1, levels = rev(d$Taxon))
dfm$Var_new = str_wrap(dfm$Var1, width = 40)
p2 <- ggplot(dfm, aes(x = Var_new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p2)
theme_set(theme_bw(base_size = 13))
dfm <- melt(abundances(ps.core))
dfm$Var1 <- factor(dfm$Var1, levels = rev(d$Taxon))
dfm$Var_new = str_wrap(dfm$Var1, width = 40)
p2 <- ggplot(dfm, aes(x = Var_new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p2)
ps <- aggregate_taxa(phy20.1, "phylum")
ps <- microbiome::transform(ps, "compositional")
ps.core <- core(ps, detection = core_detection, prevalence = core_prevalence)
m <- round(100 * rowMeans(abundances(ps.core)), 1)
#median <- round(100 * apply(abundances(ps.core), 1, median), 1)
prev <- round(100 * prevalence(ps.core, detection = core_detection), 1)
d <- as.data.frame(list(Taxon = names(m), Abundance_mean = m, Prevalence = prev))
rownames(d) <- NULL
d <- d %>% arrange(desc(Abundance_mean), desc(Prevalence))
colnames(d) <- c("Taxon", "Mean Relative abundance (%)", "Prevalence (%)")
kable(d)
library(knitr)
a <- aggregate_taxa(phy20.1, level = "genus")
xc <- abundances(transform(a, "compositional"))
df <- melt(xc)
names(df) <- c("Genus", "sample", "value")
dfm <- df %>% group_by(Genus) %>%
summarise(mean = round(100 * mean(value), 1),
#median = round(100 * median(value), 1),
#min = round(100 * min(value), 1),
#max = round(100 * max(value), 1),
prevalence = round(100 * prevalence(value), 1))%>%
arrange(desc(mean))
#kable(dfm)
#write.csv(dfm, file="genus table.csv")
library(data.table)
a <- data.table:::print.data.table(dfm, nrows = 18, topn=18)
#b <- aggregate_taxa(phy20.1, level = "genus")
#cd <- abundances(transform(b, "compositional"))
#xd <- reshape2::melt(cd)
#df$phylum <- map_levels(taxa = df$genus, from = "genus", to = "phylum", data = phy20.1)
#ggplot(df, aes(x = Genus, y = value, fill = phylum)) + geom_boxplot()
#b <- aggregate_taxa(ps.core, level = "genus")
#b <- aggregate_taxa(ps.core, level = "unique")
#cd <- abundances(transform(b, "compositional"))
#xd <- reshape2::melt(cd)
#df$phylum <- map_levels(taxa = df$unique, from = "unique", to = "phylum", data = b)
#ggplot(df, aes(x = Genus, y = value, fill = phylum)) + geom_boxplot()
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
bs$Var3 = str_wrap(bs$Var2, width =30)
p4 <- ggplot(bs, aes(x = reorder(Var1, -value), y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
#df$phylum <- map_levels(taxa = df$genus, from = "genus", to = "phylum", data = b.core)
#x <- abundances(phy20.1, level = "genus") #["genus", ]
#xd <- reshape2::melt(x)
#df$Phylum <- map_levels(taxa = df$Genus, from = "Genus", to = "Phylum", data = pseq)
#ggplot(df, aes(x = Genus, y = abundance, fill = Phylum)) + geom_boxplot()
#theme_set(theme_bw(base_size = 20))
#x <- prevalence(b.core)
#df <- data.frame(prevalence = x)
#df$Genus <- names(x)
#ggplot(df, aes(x = Genus, y = prevalence )) + geom_bar(stat = "identity")	+scale_y_log10(label = scales::percent) + coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#o <- plot_taxa_prevalence(df, level = "genus", prevalence(50/100))
#print(o)
theme_set(theme_bw(base_size = 20))
x <- prevalence(b.core)
df <- data.frame(prevalence = x)
df$Genus <- names(x)
df$Genus <- factor(df$Genus, levels= c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium",
"Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus"))
ggplot(df, aes(x = df$Genus, y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
#ggplot(df, aes(x = reorder(Genus, -prevalence), y = prevalence )) + geom_bar(stat = "identity")	+ coord_flip() + theme(axis.text.x = element_text(angle = 0, hjust = 1)) + labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
bs$Var3 = str_wrap(bs$Var2, width =30)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
bs$Var3 = str_wrap(bs$Var2, width =30)
p4 <- ggplot(bs, aes(x = reorder(Var1, -value), y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
bs$Var3 = str_wrap(bs$Var2, width =30)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
bs$Var3 = str_wrap(bs$Var2, width =30)
p4 <- ggplot(bs, aes(x = Var2, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
bs$Var3 = str_wrap(bs$Var2, width =30)
p4 <- ggplot(bs, aes(x = Var1, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
