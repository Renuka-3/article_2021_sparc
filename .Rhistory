col = "Sample",
shading = FALSE, colors("NC"))
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE, colour = "NC")
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE, colour = NC)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE, colour= NC)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
cphy <- readRDS("data/with_control/phyloseq/cphy.RDS")
# Estimate alpha diversities
A <- alpha(cphy)
library(Cairo)
df <- meta(cphy)
df <- bind_cols(df, A)
df$index <- df[[index]]
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
index <- "diversity_shannon"
theme_set(theme_bw(15))
library(microbiome)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE, colour = "NC")
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE)
print(p)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "NC",
shading = FALSE)
print(p)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3)
print(p)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col = "Samples(NC)")
print(p)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col = "Samples"("NC""))
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col = "Samples"("NC"")))
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col = (NC,"Samples"))
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col = (NC,Samples))
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col =(NC,Samples))
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col= sample$NC)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col= sample$NC))
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col= Sample$NC))
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3, col= Sample$NC))
cols <- sample(NC)
cols <- sample("NC")
cols[which(cols %in% NC)] <- red
cols[which(cols %in% NC)] <- "red"
cols <- meta$Sample
cols[which(cols %in% NC)] <- "red"
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
index <- "diversity_shannon"
# Estimate alpha diversities
A <- alpha(phy)
library(knitr)
library(knitcitations)
library(phyloseq)
library(ggplot2)
library(microbiome)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
cphy <- readRDS("data/with_control/phyloseq/cphy.RDS")
# Estimate alpha diversities
A <- alpha(cphy)
library(Cairo)
df <- meta(cphy)
df <- bind_cols(df, A)
df$index <- df[[index]]
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
index <- "diversity_shannon"
theme_set(theme_bw(15))
library(microbiome)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE, colors(NC))
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE)
print(p)
cols <- meta$Sample
cols[which(cols %in% NC)] <- "red"
cols[which(cols %in% "NC")] <- "red"
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "cols",
shading = FALSE)
print(p)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = cols,
shading = FALSE)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE)
print(p)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = cols,
shading = FALSE)
View(cols)
data.frame sample_data(cphy)$control <- cols
sample_data(cphy)$control <- cols
data.frame meta_data(cphy)$control <- cols
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
cphy <- readRDS("data/with_control/phyloseq/cphy.RDS")
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
index <- "diversity_shannon"
theme_set(theme_bw(15))
sample_data(cphy)$control <- cols
sample_data(cphy)$control <- cols
rm <- meta_data$Sample("NC")
rm <- meta_data$Sample(NC)
########
otu_mat    <- as.data.frame(read_excel("data/with_control/otucontrol.xlsx"))
library(ggplot2)
library(microbiome)
library(phyloseq)
library(dada2)
library(readxl)
library(dplyr)
########
otu_mat    <- as.data.frame(read_excel("data/with_control/otucontrol.xlsx"))
tax_mat    <- as.data.frame(read_excel("data/with_control/taxacontrol.xlsx"))
samples_df <- as.data.frame(read_excel("data/with_control/metacontrol.xlsx"))
########
otu_mat    <- as.data.frame(read_excel("data/with_control/otucontrol.xlsx"))
tax_mat    <- as.data.frame(read_excel("data/with_control/taxacontrol.xlsx"))
samples_df <- as.data.frame(read_excel("data/with_control/metacontrol.xlsx"))
row.names(otu_mat) <- otu_mat$OTUU
otu_mat <- otu_mat %>% select (-OTUU)
row.names(tax_mat) <- tax_mat$OTUU
tax_mat <- tax_mat %>% select (-OTUU)
row.names(samples_df) <- samples_df$Sample
#samples_df <- samples_df %>% select (-Sample)
otu_mat <- as.matrix(otu_mat)
tax_mat <- as.matrix(tax_mat)
OTU = otu_table(otu_mat, taxa_are_rows = TRUE)
TAX = tax_table(tax_mat)
sam = sample_data(as.data.frame(samples_df))
control <- phyloseq(OTU, TAX, sam)
control
sample_data(control)
library("phyloseq")
library("ggplot2")
library("cluster")
library("igraph")
library("markovchain")
library("RColorBrewer")
library(microbiome)
library("gridExtra")
set.seed(455423)
default.par <- par(no.readonly = TRUE)
options(stringsAsFactors = FALSE)
theme_set(theme_bw())
# EXCLUDEMARGINAL is a flag to exclude marginally preterm births (=37 weeks) in the later analysis
#EXCLUDEMARGINAL = TRUE
#site <- "Vaginal_Swab"
ps <- readRDS("data/processed/phyloseq/phy20.1.RDS")
tt <- data.frame(tax_table(ps))
ps <- transform_sample_counts(ps, function(OTU) OTU/sum(OTU))
ps1<- prune_taxa(names(sort(taxa_sums(ps), T))[1:50], ps)
taxa.order1<- taxa_names(ps1)
braydist <- phyloseq::distance(ps, method="bray")
ord = ordinate(ps, method = "MDS", distance = braydist)
plot_scree(ord) + xlim(as.character(seq(1,15))) + ggtitle("MDS-bray ordination eigenvalues")
evs <- ord$value$Eigenvalues
print(evs[1:20])
print(tail(evs))
h_sub5 <- hist(evs[6:length(evs)], 100)
plot(h_sub5$mids, h_sub5$count, log="y", type='h', lwd=10, lend=2)
NDIM <- 7
x <- ord$vectors[,1:NDIM]  # rows=sample, cols=MDS axes, entries = value
pamPCoA = function(x, k) {
list(cluster = pam(x[,1:2], k, cluster.only = TRUE))
}
gs = clusGap(x, FUN = pamPCoA, K.max = 12, B = 50)
plot_clusgap(gs) + scale_x_continuous(breaks=c(seq(0, 12, 2)))
K <- 3
x <- ord$vectors[,1:NDIM]
clust <- as.factor(pam(x, k=K, cluster.only=T))
# SWAPPING THE ASSIGNMENT OF 2 AND 3 TO MATCH RAVEL CST ENUMERATION
clust[clust==2] <- NA
clust[clust==3] <- 2
clust[is.na(clust)] <- 3
sample_data(ps)$CST <- clust
CSTs <- as.character(seq(K))
CSTColors <- brewer.pal(6,"Paired")[c(1,3,2,5,4,6)] # Length 6 for consistency with pre-revision CST+ coloration
names(CSTColors) <- CSTs
CSTColorScale <- scale_colour_manual(name = "CST", values = CSTColors[1:5])
CSTFillScale <- scale_fill_manual(name = "CST", values = CSTColors[1:5])
#grid.arrange(phyloseq::plot_ordination(ps, ord, color="CST") + CSTColorScale,plot_ordination(ps, ord, axes=c(3,4), color="CST") + CSTColorScale, main="Ordination by Cluster")
ok<-ordinate(ps, method="NMDS", distance=braydist)
knitr::opts_chunk$set(results = "hide")
plot_ordination(ps,ok , color="CST") + CSTColorScale + ggtitle("NMDS -- bray -- By Cluster")
View(gs)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
index <- "diversity_shannon"
sample_data(cphy)$control <- cols
sample_data(phy)$control <- cols
p <- plot_landscape(microbiome::transform(phy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = control,
shading = FALSE)
p <- plot_landscape(microbiome::transform(phy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "control",
shading = FALSE)
print(p)
View(cols)
View(col)
rm(cols)
phy
cphy
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(phyloseq)
library(microbiome)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
cphy <- readRDS("data/with_control/phyloseq/cphy.RDS")
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
index <- "diversity_shannon"
theme_set(theme_bw(15))
library(microbiome)
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE)
print(p)
knitr::opts_chunk$set(echo = TRUE)
{r alpha, message=F, echo=F, echo=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
cphy <- readRDS("data/with_control/phyloseq/cphy.RDS")
## *Principal Coordinates Analysis (PCoA)*
* Ordination method: `r method`
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
cphy <- readRDS("data/with_control/phyloseq/cphy.RDS")
theme_set(theme_bw(15))
library(microbiome)
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
#index <- "diversity_shannon"
p <- plot_landscape(microbiome::transform(cphy , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "Sample",
shading = FALSE)
print(p)
#cols <- meta$Sample
#cols[which(cols %in% "NC")] <- "red"
#p <- plot_landscape(microbiome::transform(phy , "compositional"),
distance = "bray",
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
index <- "diversity_shannon"
# Estimate alpha diversities
A <- alpha(phy)
library(Cairo)
df <- meta(phy)
df <- bind_cols(df, A)
df$index <- df[[index]]
pv <- kruskal.test(data = df, index ~ factor(Geographical_location))$p.value
library(ggbeeswarm)
p1 <- ggplot(df, aes(x = Geographical_location, y = index, fill = Geographical_location)) +
ggbeeswarm::geom_beeswarm() +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
labs(y = "Shannon Diversity",
x = "",
title = paste0("Kruskal test p=", round(pv, 2)))
print(p1)
