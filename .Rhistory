rownames(tab) <- NULL
kable(tab)
knit(analysisCST.Rmd)
knit("analysisCST.Rmd")
knit("jointanalysis.Rmd")
library(microbiome)
opts_chunk$set(dev="CairoPNG")
# Estimate alpha diversities
A <- alpha(phy)
index <- "diversity_shannon"
head(A)
c <- meta(phy)
c2 <- bind_cols(c,A)
is.data.frame(c)
is.data.frame(c2)
i <- sapply(split(t2$diversity_shannon, t2$age_group), mean)
#c <- round(100 * sapply(split(c2$diversity_shannon, c2$age_group), mean),2)
kable(i)
theme_set(theme_bw(20))
library(microbiome)
p <- plot_landscape(microbiome::transform(Q , "compositional"),
distance = "bray",
method = "PCoA",
size = 3,
col = "age_group",
shading = FALSE) +
scale_colour_brewer(palette = "Set1") +labs(title = "Age")
print(p)
knit("ageanalysis.Rmd")
library(microbiome)
library(ggplot2)
library(dplyr)
pseq <- phy# Rename the example data
data = microbiome::meta(phy)
# Pick relative abundances (compositional) and sample metadata
pseq.rel <- microbiome::transform(pseq, "compositional")
otu <- abundances(pseq.rel)
meta <- meta(pseq.rel)
library(vegan)
library(phyloseq)
permanova <- adonis(t(otu) ~ Diet,
data = meta(phy), permutations=99, method = "bray")
# P-value
print(as.data.frame(permanova$aov.tab)["Diet", "Pr(>F)"])
dist <- vegdist(t(otu))
anova(betadisper(dist, meta$Diet))
library(microbiome)
library(ggplot2)
library(dplyr)
pseq <- phy# Rename the example data
data = microbiome::meta(phy)
# Pick relative abundances (compositional) and sample metadata
pseq.rel <- microbiome::transform(pseq, "compositional")
otu <- abundances(pseq.rel)
meta <- meta(pseq.rel)
library(vegan)
library(phyloseq)
permanova <- adonis(t(otu) ~ age_group,
data = meta(phy), permutations=99, method = "bray")
# P-value
print(as.data.frame(permanova$aov.tab)["age_group", "Pr(>F)"])
dist <- vegdist(t(otu))
anova(betadisper(dist, meta$age_group))
knit("Dietanalysis.Rmd")
knit("ageanalysis.Rmd")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(phyloseq)
library(dada2)
library(readxl)
library(dplyr)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_diet/")
# Was created with: source("create_phyloseq.R")
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
knit("diet.Rmd")
knit("age.Rmd")
knit
knit(core.Rmd)
knit("core.Rmd")
library(knitr)
a <- aggregate_taxa(phy20.1, level = "genus")
xc <- abundances(transform(a, "compositional"))
df <- melt(xc)
names(df) <- c("Genus", "sample", "value")
dfm <- df %>% group_by(Genus) %>%
summarise(mean = round(100 * mean(value), 1),
#median = round(100 * median(value), 1),
#min = round(100 * min(value), 1),
#max = round(100 * max(value), 1),
prevalence = round(100 * prevalence(value), 1))%>%
arrange(desc(mean))
#kable(dfm)
#write.csv(dfm, file="genus table.csv")
library(data.table)
a <- data.table:::print.data.table(dfm, nrows = 18, topn=18)
knit("locationanalysis.Rmd")
knit("locationanalysis.Rmd")
knit("location.Rmd")
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(phyloseq)
library(dada2)
library(readxl)
library(dplyr)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_diet/")
# Was created with: source("create_phyloseq.R")
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
library(microbiome)
opts_chunk$set(dev="CairoPNG")
# Estimate alpha diversities
A <- alpha(phy)
index <- "diversity_shannon"
head(A)
t <- meta(phy)
t2 <- bind_cols(t,A)
is.data.frame(t)
is.data.frame(t2)
s <- sapply(split(t2$diversity_shannon, t2$Diet), mean)
kable(s)
g <- sapply(split(t2$diversity_shannon, t2$Diet), sd)
kable(g)
y <- cbind(s,g)
kable(y)
library(microbiome)
opts_chunk$set(dev="CairoPNG")
# Estimate alpha diversities
A <- alpha(phy)
index <- "diversity_shannon"
c <- meta(phy)
c2 <- bind_cols(c,A)
is.data.frame(c)
is.data.frame(c2)
i <- sapply(split(c2$diversity_shannon, c2$age_group), mean)
o <- sapply(split(c2$diversity_shannon, c2$Diet), sd)
j <- cbind(i,o)
kable(j)
# Estimate alpha diversities
A <- alpha(phy)
b <- meta(phy)
b2 <- bind_cols(b,A)
is.data.frame(b)
is.data.frame(b2)
z<- sapply(split(b2$diversity_shannon, b2$Geographical_location), mean)
f <- sapply(split(b2$diversity_shannon, b2$Geographical_location), sd)
v <- cbind(z,f)
kable(v)
o <- sapply(split(c2$diversity_shannon, c2$age_group), sd)
j <- cbind(i,o)
kable(j)
library(Cairo)
theme_set(theme_bw(base_size=25))
df <- meta(phy)
df <- bind_cols(df, A)
df$index <- df[[index]]
pv <- kruskal.test(data = df, index ~ factor(age_group))$p.value
kruskal.test(data = df, index ~ factor(age_group))
library(ggbeeswarm)
p1 <- ggplot(df, aes(x = age_group, y = index)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +theme(legend.position = "none")+
labs(y = "Shannon Diversity",
x = "",
title = "Age group")
print(p1)
theme_set(theme_bw(base_size=25))
library(Cairo)
df <- meta(phy)
df <- bind_cols(df, A)
df$index <- df[[index]]
pv <- kruskal.test(data = df, index ~ factor(Geographical_location))$p.value
library(ggbeeswarm)
p1 <- ggplot(df, aes(x = Geographical_location, y = index)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) + theme(legend.position = "none")+
labs(y = "Shannon Diversity",
x = "",
title = "geographical location")
print(p1)
theme_set(theme_bw(base_size=25))
library(Cairo)
df <- meta(phy)
df <- bind_cols(df, A)
df$index <- df[[index]]
pv <- kruskal.test(data = df, index ~ factor(Geographical_location))$p.value
library(ggbeeswarm)
p1 <- ggplot(df, aes(x = Geographical_location, y = index)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) + theme(legend.position = "none")+
labs(y = "Shannon Diversity",
x = "",
title = "Geographical location")
print(p1)
library(microbiome)
library(phyloseq)
library(vegan)
library(Cairo)
library(knitr)
library(knitcitations)
library(microbiome)
library(ggplot2)
library(dplyr)
library(vegan)
library(phyloseq)
library(microbiome)
library(phyloseq)
library(reshape2)
library(DESeq2)
opts_chunk$set(dev="CairoPNG")
knitr::opts_chunk$set(fig.path="figure_joint/")
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
theme_set(theme_bw(30))
p <- plot_landscape(microbiome::transform(phy , "compositional"),
distance = distance,
method = method,
size = 5,
col = "Diet",
shading = FALSE) +
scale_colour_brewer(palette = "Set1")	+ labs(title = "Diet") + theme(legend.position = 'bottom')
#legend.direction = "horizontal",
#legend.box = "horizontal") +
#guides(color = guide_legend(title.position = "top",
#label.position = "bottom"))
print(p)
p1 <- plot_landscape(microbiome::transform(phy , "compositional"),
distance = distance,
method = method,
size = 5,
col = "Geographical_location",
shading = FALSE) +
scale_colour_brewer(palette = "Set1") + labs(title = "Geographical location") + theme(legend.position = 'bottom', legend.text=element_text(size=12), legend.title=element_text(size=22))
print(p1)
p2 <- plot_landscape(microbiome::transform(phy , "compositional"),
distance = distance,
method = method,
size = 5,
col = "age_group",
shading = FALSE) +
scale_colour_brewer(palette = "Set1")	+ labs(title = "Age group")+ theme(legend.position = 'bottom', legend.text=element_text(size=20), legend.title=element_text(size=25))
print(p2)
gridExtra::grid.arrange(p, p1, p2, nrow = 1)
knit("age.Rmd")
knit("age.Rmd")
library(knitr)
knit("age.Rmd")
knit("location.Rmd")
knit("diet.Rmd")
library(knitr)
require(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
core_detection <- .1/100
core_prevalence <- 50/100
# Was created with: source("create_phyloseq.R")
phy20.1 <- readRDS("data/processed/phyloseq/phy20.1.RDS")
ps <- aggregate_taxa(phy20.1, "genus")
ps <- microbiome::transform(ps, "compositional")
ps.core <- core(ps, detection = core_detection, prevalence = core_prevalence)
m <- round(100 * rowMeans(abundances(ps.core)), 1)
median <- round(100 * apply(abundances(ps.core), 1, median), 1)
prev <- round(100 * prevalence(ps.core, detection = core_detection), 1)
d <- as.data.frame(list(Taxon = names(m), Abundance_mean = m, Abundance_median = median, Prevalence = prev))
rownames(d) <- NULL
d <- d %>% arrange(desc(Abundance_mean), desc(Prevalence))
colnames(d) <- c("Taxon", "Mean Relative abundance (%)", "Median Relative abundance (%)", "Prevalence (%)")
kable(d)
theme_set(theme_bw(base_size = 13))
dfm <- melt(abundances(ps.core))
dfm$Var1 <- factor(dfm$Var1, levels = rev(d$Taxon))
dfm$Var_new = str_wrap(dfm$Var1, width = 40)
p2 <- ggplot(dfm, aes(x = Var_new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p2)
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(phyloseq)
library(dada2)
library(readxl)
library(dplyr)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_diet/")
# Was created with: source("create_phyloseq.R")
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
library(microbiome)
opts_chunk$set(dev="CairoPNG")
# Estimate alpha diversities
A <- alpha(phy)
index <- "diversity_shannon"
head(A)
t <- meta(phy)
t2 <- bind_cols(t,A)
is.data.frame(t)
is.data.frame(t2)
s <- sapply(split(t2$diversity_shannon, t2$Diet), mean)
kable(s)
library(microbiome)
opts_chunk$set(dev="CairoPNG")
# Estimate alpha diversities
A <- alpha(phy)
index <- "diversity_shannon"
head(A)
t <- meta(phy)
t2 <- bind_cols(t,A)
is.data.frame(t)
is.data.frame(t2)
s <- sapply(split(t2$diversity_shannon, t2$Diet), mean)
g <- sapply(split(t2$diversity_shannon, t2$Diet), sd)
y <- cbind(s,g)
kable(y)
knit("diet.Rmd")
library(knitr)
knit("diet.Rmd")
theme_set(theme_bw(base_size = 25))
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(phyloseq)
library(dada2)
library(readxl)
library(dplyr)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_diet/")
# Was created with: source("create_phyloseq.R")
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
library(microbiome)
opts_chunk$set(dev="CairoPNG")
# Estimate alpha diversities
A <- alpha(phy)
index <- "diversity_shannon"
head(A)
t <- meta(phy)
t2 <- bind_cols(t,A)
is.data.frame(t)
is.data.frame(t2)
s <- sapply(split(t2$diversity_shannon, t2$Diet), mean)
g <- sapply(split(t2$diversity_shannon, t2$Diet), sd)
y <- cbind(s,g)
kable(y)
theme_set(theme_bw(base_size = 25))
library(Cairo)
df <- meta(phy)
df <- bind_cols(df, A)
df$index <- df[[index]]
pv <- wilcox.test(data = df, index ~ factor(Diet))$p.value
kruskal.test(data = df, index ~factor(Diet))
library(ggbeeswarm)
p1 <- ggplot(df, aes(x = Diet, y = index)) +
geom_boxplot() +
geom_jitter(width = 0.05) +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +theme(legend.position = "none")+
labs(y = "Shannon Diversity",
x = "",
title = "Diet")
print(p1)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
index <- "diversity_shannon"
# Estimate alpha diversities
A <- alpha(phy)
b <- meta(phy)
b2 <- bind_cols(b,A)
is.data.frame(b)
is.data.frame(b2)
z<- sapply(split(b2$diversity_shannon, b2$Geographical_location), mean)
f <- sapply(split(b2$diversity_shannon, b2$Geographical_location), sd)
v <- cbind(z,f)
kable(v)
theme_set(theme_bw(base_size=25))
library(Cairo)
df <- meta(phy)
df <- bind_cols(df, A)
df$index <- df[[index]]
pv <- kruskal.test(data = df, index ~ factor(Geographical_location))$p.value
kruskal.test(data = df, index ~factor(Geographical_location))
library(ggbeeswarm)
p1 <- ggplot(df, aes(x = Geographical_location, y = index)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) + theme(legend.position = "none")+
labs(y = "Shannon Diversity",
x = "",
title = "Geographical location")
print(p1)
library(knitr)
knit("diet.Rmd")
knit("location.Rmd")
theme_set(theme_bw(base_size = 25))
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(phyloseq)
library(dada2)
library(readxl)
library(dplyr)
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_diet/")
# Was created with: source("create_phyloseq.R")
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
library(knitr)
knit("diet.Rmd")
library(knitr)
knit("diet.Rmd")
library(ggplot2)
library(microbiome)
library(phyloseq)
library(dada2)
library(readxl)
library(dplyr)
otu_mat    <- as.data.frame(read_excel("data/processed/original_tables/otu.xlsx"))
tax_mat    <- as.data.frame(read_excel("data/processed/original_tables/taxa.xlsx"))
samples_df <- as.data.frame(read_excel("data/processed/original_tables/meta.xlsx"))
row.names(otu_mat) <- otu_mat$OTUU
otu_mat <- otu_mat %>% select (-OTUU)
row.names(tax_mat) <- tax_mat$OTUU
tax_mat <- tax_mat %>% select (-OTUU)
row.names(samples_df) <- samples_df$Sample
#samples_df <- samples_df %>% select (-Sample)
otu_mat <- as.matrix(otu_mat)
tax_mat <- as.matrix(tax_mat)
OTU = otu_table(otu_mat, taxa_are_rows = TRUE)
TAX = tax_table(tax_mat)
sam = sample_data(as.data.frame(samples_df))
# Add age group information also
phy <- phyloseq(OTU, TAX, sam)
sample_data(phy)$age_group <- cut(meta(phy)$Age, breaks = c(0, 40, 59, Inf), labels = c("adult", "middle_age", "elderly"))
saveRDS(phy, file = "data/processed/phyloseq/phy20.1.RDS")
phy
