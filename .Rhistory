dfm <- melt(abundances(ps.core))
dfm$Var1 <- factor(dfm$Var1, levels = rev(d$Taxon))
dfm$Var_new = str_wrap(dfm$Var1, width = 40)
p2 <- ggplot(dfm, aes(x = Var_new, y = value)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p2)
ps <- aggregate_taxa(phy20.1, "phylum")
ps <- microbiome::transform(ps, "compositional")
ps.core <- core(ps, detection = core_detection, prevalence = core_prevalence)
m <- round(100 * rowMeans(abundances(ps.core)), 1)
#median <- round(100 * apply(abundances(ps.core), 1, median), 1)
prev <- round(100 * prevalence(ps.core, detection = core_detection), 1)
d <- as.data.frame(list(Taxon = names(m), Abundance_mean = m, Prevalence = prev))
rownames(d) <- NULL
d <- d %>% arrange(desc(Abundance_mean), desc(Prevalence))
colnames(d) <- c("Taxon", "Mean Relative abundance (%)", "Prevalence (%)")
kable(d)
library(knitr)
a <- aggregate_taxa(phy20.1, level = "genus")
xc <- abundances(transform(a, "compositional"))
df <- melt(xc)
names(df) <- c("Genus", "sample", "value")
dfm <- df %>% group_by(Genus) %>%
summarise(mean = round(100 * mean(value), 1),
#median = round(100 * median(value), 1),
#min = round(100 * min(value), 1),
#max = round(100 * max(value), 1),
prevalence = round(100 * prevalence(value), 1))%>%
arrange(desc(mean))
#kable(dfm)
#write.csv(dfm, file="genus table.csv")
library(data.table)
a <- data.table:::print.data.table(dfm, nrows = 18, topn=18)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(df)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(df)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(df)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(df)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
#bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 20))
#sorted.names <- c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium", "Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus")
x <- prevalence(b.core)
df <- data.frame(prevalence = x) %>% arrange(prevalence) # Also sort by prevalence
df$Genus <- rownames(df)
sorted.names <- rownames(df) # Use the same order than in prevalences that were now sorted by magnitude
#sorted.names <- sort(rownames(df)) # Alphabetic order
df$Genus <- factor(df$Genus, levels=sorted.names)
#df$Genus <- gsub(df$Genus, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
#df$Genus <- factor(df$Genus, levels=sorted.names)
ggplot(df, aes(x = df$Genus, y = prevalence)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
theme_set(theme_bw(base_size = 20))
#sorted.names <- c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium", "Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus")
x <- prevalence(b.core)
df <- data.frame(prevalence = x) %>% arrange(prevalence) # Also sort by prevalence
df$Genus <- rownames(df)
sorted.names <- rownames(df) # Use the same order than in prevalences that were now sorted by magnitude
#sorted.names <- sort(rownames(df)) # Alphabetic order
df$Genus <- factor(df$Genus, levels=sorted.names)
df$Genus <- gsub(df$Genus, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
#df$Genus <- factor(df$Genus, levels=sorted.names)
ggplot(df, aes(x = df$Genus, y = prevalence)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 20))
#sorted.names <- c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium", "Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus")
x <- prevalence(b.core)
df <- data.frame(prevalence = x) %>% arrange(prevalence) # Also sort by prevalence
df$Genus <- rownames(df)
sorted.names <- rownames(df) # Use the same order than in prevalences that were now sorted by magnitude
#sorted.names <- sort(rownames(df)) # Alphabetic order
df$Genus <- factor(df$Genus, levels=sorted.names)
df$Genus <- gsub(df$Genus, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
#df$Genus <- factor(df$Genus, levels=sorted.names)
ggplot(df, aes(x = df$Genus, y = prevalence)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = y) %>% arrange(abundances)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
#bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances = x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 20))
#sorted.names <- c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium", "Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus")
x <- prevalence(b.core)
df <- data.frame(prevalence = x) %>% arrange(prevalence) # Also sort by prevalence
df$Genus <- rownames(df)
sorted.names <- rownames(df) # Use the same order than in prevalences that were now sorted by magnitude
#sorted.names <- sort(rownames(df)) # Alphabetic order
df$Genus <- factor(df$Genus, levels=sorted.names)
df$Genus <- gsub(df$Genus, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
#df$Genus <- factor(df$Genus, levels=sorted.names)
ggplot(df, aes(x = df$Genus, y = prevalence)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
theme_set(theme_bw(base_size = 20))
#sorted.names <- c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium", "Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus")
x <- prevalence(b.core)
df <- data.frame(prevalence = x) %>% arrange(prevalence) # Also sort by prevalence
df$Genus <- rownames(df)
sorted.names <- rownames(df) # Use the same order than in prevalences that were now sorted by magnitude
#sorted.names <- sort(rownames(df)) # Alphabetic order
df$Genus <- factor(df$Genus, levels=sorted.names)
df$Genus <- gsub(df$Genus, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
#df$Genus <- factor(df$Genus, levels=sorted.names)
ggplot(df, aes(x = df$Genus, y = prevalence)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances =b.core) %>% arrange(abundances)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances =x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 20))
#sorted.names <- c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium", "Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus")
x <- prevalence(b.core)
df <- data.frame(prevalence = x) %>% arrange(prevalence) # Also sort by prevalence
df$Genus <- rownames(df)
sorted.names <- rownames(df) # Use the same order than in prevalences that were now sorted by magnitude
#sorted.names <- sort(rownames(df)) # Alphabetic order
df$Genus <- factor(df$Genus, levels=sorted.names)
df$Genus <- gsub(df$Genus, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
#df$Genus <- factor(df$Genus, levels=sorted.names)
ggplot(df, aes(x = df$Genus, y = prevalence)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
theme_set(theme_bw(base_size = 20))
#sorted.names <- c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium", "Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus")
x <- prevalence(b.core)
df <- data.frame(prevalence = x) %>% arrange(prevalence) # Also sort by prevalence
df$Genus <- rownames(df)
sorted.names <- rownames(df) # Use the same order than in prevalences that were now sorted by magnitude
#sorted.names <- sort(rownames(df)) # Alphabetic order
df$Genus <- factor(df$Genus, levels=sorted.names)
df$Genus <- gsub(df$Genus, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
#df$Genus <- factor(df$Genus, levels=sorted.names)
ggplot(df, aes(x = df$Genus, y = prevalence)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances =x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances =x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 20))
#sorted.names <- c("Acinetobacter", "Aeromonas", "Anaerococcus", "Arthrobacter", "Bacillus", "Brevibacillus", "Brevibacterium", "Clostridium", "Corynebacterium", "Enterobacter", "Exiguobacterium", "Geobacillus", "Intestinimonas", "Micrococcus", "Moraxella", "Oceanobacillus", "Paenibacillus", "Pantoea", "Propionibacterium", "Pseudomonas", "Salmonella" ,"Staphylococcus", "Thiolamprovum", "Virgibacillus")
x <- prevalence(b.core)
df <- data.frame(prevalence = x) %>% arrange(prevalence) # Also sort by prevalence
df$Genus <- rownames(df)
sorted.names <- rownames(df) # Use the same order than in prevalences that were now sorted by magnitude
#sorted.names <- sort(rownames(df)) # Alphabetic order
df$Genus <- factor(df$Genus, levels=sorted.names)
df$Genus <- gsub(df$Genus, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
#df$Genus <- factor(df$Genus, levels=sorted.names)
ggplot(df, aes(x = df$Genus, y = prevalence)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(axis.text.x = element_text(angle = 0, hjust = 1)) +
labs(y = "Prevalence (%)", x = 'Genus', title = "Core prevalence variation")
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
x <- prevalence(b.core)
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances =x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
theme_set(theme_bw(base_size = 18))
core_detection1 <- .1/100
core_prevalence <- 20/100
b <- aggregate_taxa(phy20.1, "genus")
b <- microbiome::transform(b, "compositional")
b.core <- core(b, detection = core_detection1, prevalence = core_prevalence)
x <- prevalence(b.core)
bs <- melt(abundances(b.core))
bs <- data.frame(abundances =x) %>% arrange(abundances)
bs$Var1 <- rownames(bs)
sorted.names <- rownames(bs)
bs$Var1 <- factor(bs$Var1, levels=sorted.names)
#bs$Var2 <- factor(bs$Var2, levels = rev(d$Taxon))
#bs$Var3 = str_wrap(bs$Var2, width =30)
bs$Var1 <- gsub(bs$Var1, pattern = "Propionibacterium", replacement = "Propionibacterium/Cutibacterium")
p4 <- ggplot(bs, aes(x = Var1, y = abundances)) +
geom_boxplot() +
geom_jitter(width = 0.1) +
#scale_y_log10(label = scales::percent) +
coord_flip() + theme(legend.position="none") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance variation")
print(p4)
