phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
theme_set(theme_bw(base_size=20))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
theme_set(theme_bw(base_size=20))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
theme_set(theme_bw(base_size=15))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
theme_set(theme_bw(base_size=25))
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
print(k)
print(k)
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "genus")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
genus.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$genus <- factor(df$genus, levels=genus.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = genus, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("genus", palette = "Paired") + facet_grid(Geographical_location ~ .) + theme(axis.text.x = element_blank())
print(f)
for pune
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "genus")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
genus.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$genus <- factor(df$genus, levels=genus.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = genus, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("genus", palette = "Paired") + facet_grid(Geographical_location ~ .) + theme(axis.text.x = element_blank())
print(f)
#for pune
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = genus, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("genus", palette = "Paired") + facet_grid(Geographical_location ~ .) + theme(axis.text.x = element_blank())
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = genus, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + facet_grid(Geographical_location ~ .) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
#worked##tp <- ggplot(df, aes(x = Sample, fill = genus, y = Abundance)) + geom_bar(stat = "identity", colour = "black") + facet_grid(Geographical_location ~ .)
s <- ggplot(w, aes(x = Sample, y = Abundance, fill = Geographical_location)) + geom_bar(stat = "identity") +
labs(y = "Relative abundance (%)", x = '', title = "Core abundance")
print(I)
#re = subset_samples(df, Geographical_location=="Ahmednagar")
dfdf <- md %>% arrange(Abundance) #leo 21.37
df$test <- factor(df$test, levels=unique(df$test))
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(width = 09, height = 10, stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(width = 02, height = 10, stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
print(u)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
```{r renuka, echo=FALSE, message=FALSE, warning=FALSE, fig.width=15, fig.height=6}
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Spectral") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Set1") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set1") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
```{r renuka, echo=FALSE, message=FALSE, warning=FALSE, fig.width=15, fig.height=6}
```{r phyla, echo=FALSE, message=FALSE, warning=FALSE, fig.width=15, fig.height=6}
```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=15, fig.height=6}
library(knitr)
library(knitcitations)
library(microbiome)
library(phyloseq)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(dada2)
library(dplyr)
library(microbiome)
library(microbiome)
library(phyloseq)
library(vegan)
theme_set(theme_bw(20))
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
knitr::opts_chunk$set(fig.path="figure_location/")
opts_chunk$set(dev="CairoPNG")
# Was created with: source("create_phyloseq.R")
phy <- readRDS("data/processed/phyloseq/phy20.1.RDS")
method <- "PCoA"
trans <- "compositional"
distance <- "bray"
index <- "diversity_shannon"
```{r alpha1, echo=FALSE, message=FALSE, warning=FALSE}
```{r alpha1, echo=FALSE, message=FALSE, warning=FALSE}
```{r chunk label, echo=FALSE, message=FALSE, warning=FALSE, fig.width=15, fig.height=6}
library(knitr)
library(knitcitations)
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
```{r chunk label, echo=FALSE, message=FALSE, warning=FALSE, fig.width=15, fig.height=6}
```{r chunk label, echo=FALSE, message=FALSE, warning=FALSE, fig.width=15, fig.height=6}
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
knitr::opts_chunk$set(fig.width=5, fig.height=5, message=FALSE, warning=FALSE)
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
knitr::opts_chunk$set(fig.width=10, fig.height=10, message=FALSE, warning=FALSE)
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
knitr::opts_chunk$set(fig.width=15, fig.height=10, message=FALSE, warning=FALSE)
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
grid.arrange(f, m, u , nrow = 1)
print(f)
knitr::opts_chunk$set(fig.width=15, fig.height=10, message=FALSE, warning=FALSE)
theme_set(theme_bw(base_size=25))
transform <- microbiome::transform
j <- transform(phy, "compositional")
sp <- aggregate_taxa(j, "phylum")
#today md <-  psmelt(sp)
#today op <- aggregate_rare(md, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#tax_table(sp$other) <- aggregate_rare(sp, level = 'genus',detection = 0.1/100, prevalence = 20/100, include.lowest =FALSE)
o <- aggregate_rare(sp, level = 'phylum',detection = 0.1/100, prevalence = 20/100, include.lowest =TRUE)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
#@# md <-  psmelt(o)
phyla.ordering <- names(sort(rowMeans(abundances(transform(o, "compositional")))))
df <- psmelt(o)
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
sorted.samples.by.Firmicutes <- unlist(subset(df, Phylum=="Firmicutes") %>% arrange(value) %>% select(Sample))
df$Phylum <- factor(df$phylum, levels=phyla.ordering)
sorted.samples.by.Firmicutes <- unlist(subset(df, Phylum=="Firmicutes") %>% arrange(Abundance) %>% select(Sample))
df$Sample <- factor(df$Sample, levels = sorted.samples.by.Firmicutes)
w <- df %>% filter (Geographical_location=="Ahmednagar")
f <- ggplot(w, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "Relative abundance (%)", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(),legend.position = "none")
print(f)
l <- df %>% filter (Geographical_location=="Pune")
m <- ggplot(l, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent)  + scale_fill_brewer("Phylum", palette = "Set3") + facet_grid(Geographical_location ~ .) +  facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank(), legend.position = "none")
print(m)
n <- df %>% filter (Geographical_location=="Nashik")
u <- ggplot(n, aes(x = Sample, fill = Phylum, y = Abundance)) + geom_bar(stat = "identity", colour = "black") +
labs(y =  "", x = "") + scale_y_continuous(label=scales::percent) + scale_fill_brewer("Phyla", palette = "Set3") + facet_grid(Geographical_location ~ .) + facet_grid(cols = vars(Geographical_location)) + theme(axis.text.x = element_blank())
print(u)
library("gridExtra")
grid.arrange(f, m, u , nrow = 1)
